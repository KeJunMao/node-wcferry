{"version":3,"sources":["../../../../../packages/core/src/lib/message.ts"],"sourcesContent":["import { wcf } from './proto-generated/wcf';\r\nimport { ToPlainType } from './utils';\r\n\r\nexport type RawMessage = ToPlainType<wcf.WxMsg>;\r\n\r\nexport class Message {\r\n    constructor(private readonly message: wcf.WxMsg) {}\r\n\r\n    get raw(): RawMessage {\r\n        return this.message.toObject() as RawMessage;\r\n    }\r\n\r\n    get id() {\r\n        return this.message.id;\r\n    }\r\n\r\n    get type() {\r\n        return this.message.type;\r\n    }\r\n\r\n    get isSelf() {\r\n        return this.message.is_self;\r\n    }\r\n\r\n    isAt(wxid: string) {\r\n        if (!this.isGroup) {\r\n            return false;\r\n        }\r\n        if (\r\n            !new RegExp(`<atuserlist\\\\>.*(${wxid}).*</atuserlist>`).test(\r\n                this.xml\r\n            )\r\n        ) {\r\n            return false;\r\n        }\r\n        if (/@(?:所有人|all|All)/.test(this.message.content)) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    get xml() {\r\n        return this.message.xml;\r\n    }\r\n\r\n    get isGroup() {\r\n        return this.message.is_group;\r\n    }\r\n\r\n    get roomId() {\r\n        return this.message.roomid;\r\n    }\r\n\r\n    get content() {\r\n        return this.message.content;\r\n    }\r\n\r\n    get sender() {\r\n        return this.message.sender;\r\n    }\r\n}\r\n"],"names":["Message","raw","message","toObject","id","type","isSelf","is_self","isAt","wxid","isGroup","RegExp","test","xml","content","is_group","roomId","roomid","sender","constructor"],"mappings":";;;;+BAKaA;;;eAAAA;;;AAAN,IAAA,AAAMA,UAAN,MAAMA;IAGT,IAAIC,MAAkB;QAClB,OAAO,IAAI,CAACC,OAAO,CAACC,QAAQ;IAChC;IAEA,IAAIC,KAAK;QACL,OAAO,IAAI,CAACF,OAAO,CAACE,EAAE;IAC1B;IAEA,IAAIC,OAAO;QACP,OAAO,IAAI,CAACH,OAAO,CAACG,IAAI;IAC5B;IAEA,IAAIC,SAAS;QACT,OAAO,IAAI,CAACJ,OAAO,CAACK,OAAO;IAC/B;IAEAC,KAAKC,IAAY,EAAE;QACf,IAAI,CAAC,IAAI,CAACC,OAAO,EAAE;YACf,OAAO;QACX;QACA,IACI,CAAC,IAAIC,OAAO,CAAC,iBAAiB,EAAEF,KAAK,gBAAgB,CAAC,EAAEG,IAAI,CACxD,IAAI,CAACC,GAAG,GAEd;YACE,OAAO;QACX;QACA,IAAI,mBAAmBD,IAAI,CAAC,IAAI,CAACV,OAAO,CAACY,OAAO,GAAG;YAC/C,OAAO;QACX;QAEA,OAAO;IACX;IAEA,IAAID,MAAM;QACN,OAAO,IAAI,CAACX,OAAO,CAACW,GAAG;IAC3B;IAEA,IAAIH,UAAU;QACV,OAAO,IAAI,CAACR,OAAO,CAACa,QAAQ;IAChC;IAEA,IAAIC,SAAS;QACT,OAAO,IAAI,CAACd,OAAO,CAACe,MAAM;IAC9B;IAEA,IAAIH,UAAU;QACV,OAAO,IAAI,CAACZ,OAAO,CAACY,OAAO;IAC/B;IAEA,IAAII,SAAS;QACT,OAAO,IAAI,CAAChB,OAAO,CAACgB,MAAM;IAC9B;IAtDAC,YAAY,AAAiBjB,OAAkB,CAAE;aAApBA,UAAAA;IAAqB;AAuDtD"}